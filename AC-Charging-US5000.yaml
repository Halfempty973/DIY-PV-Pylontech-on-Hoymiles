alias: AC-Laden aktivieren
trigger:
  - platform: numeric_state
    entity_id: sensor.solar_power
    above: 750
  - platform: state
    entity_id: sensor.battery1_input_power
  - platform: time_pattern
    minutes: "/1"
condition:
#  - condition: numeric_state
#    entity_id: sensor.battery_soc
#    below: 90
  - condition: state
    entity_id: switch.hoymiles_output
    state: "off"
  - condition: state
    entity_id: switch.ac_laden
    state: "on"
action:
  - variables:
      solar: "{{ states('sensor.solar_power') | float(0) }}"
      akku1: "{{ states('sensor.battery1_input_power') | float(0) }}"
      verfuegbar: "{{ solar - 500 - akku1 }}"
      ziel: "{{ [ [verfuegbar, 0] | max, 750 ] | min }}"
      strom: "{{ (ziel / 230) | round(2) }}"
  - service: number.set_value
    target:
      entity_id: number.ac_lader_current
    data:
      value: "{{ strom }}"
